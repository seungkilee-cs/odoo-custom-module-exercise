<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="view_order_form_inherit_sale_purchase_link" model="ir.ui.view">
        <field name="name">sale.order.form.inherit.sale_purchase_link</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form" />
        <field name="arch" type="xml">

            <!-- Make sure the computed field is available for modifiers -->
            <xpath expr="//sheet" position="inside">
                <field name="purchase_order_count" invisible="1" />
            </xpath>

            <!-- Smart button: appears only if at least one PO exists -->

            <!-- Default "Purchase" button exists once the purchase is tied to the sales -->
            <!-- so no need to implement this sales_order side smart button. -->
            <!-- Only configure the purchase_order side smart button for navigation. -->

            <!-- <xpath expr="//div[@name='button_box']" position="inside">
                <button
                    name="action_view_purchase_orders"
                    type="object"
                    class="oe_stat_button"
                    icon="fa-shopping-cart"
                    invisible="purchase_order_count == 0"
                >
                    <field
                        name="purchase_order_count"
                        widget="statinfo"
                        string="Purchase Orders"
                    />
                </button>
            </xpath> -->

            <!-- Create button: place it right AFTER Confirm, and hide it once a PO exists -->
            <xpath
                expr="//header//button[@name='action_confirm']"
                position="after"
            >
                <button
                    name="action_create_purchase_order"
                    string="Create PO"
                    type="object"
                    class="btn-primary"
                    invisible="purchase_order_count > 0"
                />
            </xpath>

        </field>
    </record>
</odoo>
